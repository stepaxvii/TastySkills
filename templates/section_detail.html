{% extends "base.html" %}

{% block title %}{{ section.name }} - {{ section.restaurant.name }}{% if is_demo %} - –î–µ–º–æ{% endif %}{% endblock %}

{% set breadcrumbs %}
    {% if is_demo %}
    <li class="breadcrumb-item"><a href="/demo">–î–µ–º–æ-—Ä–µ—Å—Ç–æ—Ä–∞–Ω</a></li>
    <li class="breadcrumb-item active" aria-current="page"><span>{{ section.name }}</span></li>
    {% else %}
    {% if user and user.role == 'admin' %}
    <li class="breadcrumb-item"><a href="/restaurants">–†–µ—Å—Ç–æ—Ä–∞–Ω—ã</a></li>
    {% endif %}
    <li class="breadcrumb-item"><a href="/restaurants/{{ section.restaurant.id }}">{{ section.restaurant.name }}</a></li>
    <li class="breadcrumb-item active" aria-current="page"><span>{{ section.name }}</span></li>
    {% endif %}
{% endset %}

{% block content %}
    <div class="page-header-unified">
        <h1>{{ section.name }}</h1>
        {% if user and user.role in ['admin', 'manager'] %}
        <div class="management-buttons">
            <a href="/manage/categories/create/{{ section.id }}" class="btn btn-outline-success btn-lg" title="–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é">
                ‚ûï –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            </a>
        </div>
        {% endif %}
    </div>

    {% if categories %}
    <div class="categories-list">
        {% for category in categories %}
        <div class="category-card">
            <div class="category-content" onclick="window.location.href='/restaurants/{{ section.restaurant.id }}/sections/{{ section.id }}/categories/{{ category.id }}'">
                <div class="category-image" style="width:100%;aspect-ratio:4/3;display:flex;align-items:center;justify-content:center;background:#e9ecef;border-radius:8px;margin-bottom:0.75rem;overflow:hidden;">
                    {% if category.first_product and category.first_product.image_path %}
                        <img src="/uploads/{{ category.first_product.image_path }}" alt="{{ category.title }}" style="width:100%;height:100%;object-fit:cover;display:block;border-radius:8px;">
                    {% else %}
                        üì∏
                    {% endif %}
                </div>
                <h5 class="category-title">
                    {{ category.title }}
                </h5>
                {% if category.description %}
                <p class="category-description">{{ category.description }}</p>
                {% endif %}
            </div>
            {% if user and user.role in ['admin', 'manager'] %}
            <div class="category-actions">
                <a href="/manage/categories/edit/{{ category.id }}" class="btn btn-outline-warning btn-sm" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é">‚úèÔ∏è</a>
                <button type="button" class="btn btn-outline-danger btn-sm" 
                        data-delete-url="/manage/categories/delete/{{ category.id }}"
                        data-delete-message="–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é ¬´{{ category.title }}¬ª? –í—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã."
                        title="–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é">
                    üóëÔ∏è
                </button>
            </div>
            {% endif %}
        </div>
        {% endfor %}
        {% set remainder = categories|length % 4 %}
        {% if remainder != 0 %}
            {% for _ in range(4 - remainder) %}
                <div class="category-card placeholder-card"></div>
            {% endfor %}
        {% endif %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="text-center py-5">
            <h3 class="text-muted mb-3">–ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ</h3>
            <p class="text-muted mb-4">–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –ø–æ–∫–∞ –Ω–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–æ–¥—É–∫—Ç–æ–≤.</p>
            {% if user and user.role in ['admin', 'manager'] %}
            <a href="/manage/categories/create/{{ section.id }}" class="btn btn-outline-success btn-lg">
                ‚ûï –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <div class="back-button-container">
        {% if is_demo %}
        <a href="/demo" class="btn-back">‚Üê –ù–∞–∑–∞–¥ –∫ –¥–µ–º–æ-—Ä–µ—Å—Ç–æ—Ä–∞–Ω—É</a>
        {% else %}
        <a href="/restaurants/{{ section.restaurant.id }}" class="btn-back">‚Üê –ù–∞–∑–∞–¥ –∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É</a>
        {% endif %}
    </div>

<script>
// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –≤—Å–ø–ª—ã—Ç–∏—è —Å–æ–±—ã—Ç–∏–π –æ—Ç –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
document.addEventListener('DOMContentLoaded', function() {
    const actionButtons = document.querySelectorAll('.category-actions .btn');
    actionButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    });
});
</script>
{% endblock %}

{% include 'components/delete_modal.html' %} 