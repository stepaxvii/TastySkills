{% extends "base.html" %}

{% block title %}{{ category.title }}{% if is_demo %} - –î–µ–º–æ{% endif %}{% endblock %}

{% set breadcrumbs %}
    {% if is_demo %}
    <li class="breadcrumb-item"><a href="/demo">–î–µ–º–æ-—Ä–µ—Å—Ç–æ—Ä–∞–Ω</a></li>
    <li class="breadcrumb-item"><a href="/demo">–†–∞–∑–¥–µ–ª—ã</a></li>
    <li class="breadcrumb-item active" aria-current="page"><span>{{ category.title }} (–î–µ–º–æ)</span></li>
    {% else %}
    {% if user and user.role == 'admin' %}
    <li class="breadcrumb-item"><a href="/restaurants">–†–µ—Å—Ç–æ—Ä–∞–Ω—ã</a></li>
    {% endif %}
    <li class="breadcrumb-item"><a href="/restaurants/{{ category.restaurant_id }}">{{ category.restaurant.name }}</a></li>
    <li class="breadcrumb-item"><a href="/restaurants/{{ category.restaurant_id }}/sections/{{ category.section_id }}">{{ category.section.name }}</a></li>
    <li class="breadcrumb-item active" aria-current="page"><span>{{ category.title }}</span></li>
    {% endif %}
{% endset %}

{% block content %}
    {% if is_demo %}
    <div class="alert alert-info">
        <strong>–î–µ–º–æ-–≤–µ—Ä—Å–∏—è TastySkills</strong> - —ç—Ç–æ –ø—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ–Ω—é –¥–ª—è –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–æ–≤.
        <br><small>–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ <a href="/login">–≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</a>.</small>
    </div>
    {% endif %}

    <div class="page-header-unified">
        <h1>{{ category.title }}</h1>
        {% if user and user.role in ['admin', 'manager'] %}
        <div class="management-buttons">
            <a href="/restaurants/{{ category.restaurant_id }}/sections/{{ category.section_id }}/categories/{{ category.id }}/manage/products/create" class="btn btn-outline-success" title="–°–æ–∑–¥–∞—Ç—å –±–ª—é–¥–æ">
                ‚ûï –°–æ–∑–¥–∞—Ç—å –±–ª—é–¥–æ
            </a>
            <a href="/restaurants/{{ category.restaurant_id }}/sections/{{ category.section_id }}/categories/{{ category.id }}/manage/edit" class="btn btn-outline-warning" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é">
                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            </a>
        </div>
        {% endif %}
    </div>

    {% if category.description %}
    <div class="alert alert-info">
        {{ category.description }}
    </div>
    {% endif %}

    {% if products %}
    <div class="products-grid">
        {% for product in products %}
        <div class="product-card">
            <div class="product-content" onclick="window.location.href='/restaurants/{{ category.restaurant_id }}/sections/{{ category.section_id }}/categories/{{ category.id }}/products/{{ product.id }}'">
                <div class="product-image">
                    {% if product.image_path %}
                    <img src="/uploads/{{ product.image_path }}" alt="{{ product.title }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                    {% else %}
                    <i class="fas fa-utensils"></i>
                    {% endif %}
                </div>
                <h5 class="product-title">{{ product.title }}</h5>
                {% if product.weight %}
                <p class="product-weight">{{ product.weight }}</p>
                {% endif %}
            </div>
            {% if user and user.role in ['admin', 'manager'] %}
            <div class="product-actions">
                <a href="/restaurants/{{ category.restaurant_id }}/sections/{{ category.section_id }}/categories/{{ category.id }}/products/{{ product.id }}/manage/edit" class="btn btn-outline-warning btn-sm" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª—é–¥–æ">‚úèÔ∏è</a>
                <button type="button" class="btn btn-outline-danger btn-sm" 
                        data-delete-url="/restaurants/{{ category.restaurant_id }}/sections/{{ category.section_id }}/categories/{{ category.id }}/products/{{ product.id }}/manage/delete"
                        data-delete-message="–£–¥–∞–ª–∏—Ç—å –±–ª—é–¥–æ ¬´{{ product.title }}¬ª?"
                        title="–£–¥–∞–ª–∏—Ç—å –±–ª—é–¥–æ">
                    üóëÔ∏è
                </button>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <h3>–ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ</h3>
        <p>–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç –±–ª—é–¥.</p>
        {% if user and user.role in ['admin', 'manager'] %}
        <a href="/restaurants/{{ category.restaurant_id }}/sections/{{ category.section_id }}/categories/{{ category.id }}/manage/products/create" class="btn btn-outline-success">
            ‚ûï –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–µ –±–ª—é–¥–æ
        </a>
        {% endif %}
    </div>
    {% endif %}

    <div class="back-button-container">
        <a href="/restaurants/{{ category.restaurant_id }}/sections/{{ category.section_id }}" class="btn-back">‚Üê –ù–∞–∑–∞–¥ –∫ —Ä–∞–∑–¥–µ–ª—É</a>
    </div>
{% endblock %}

{% block scripts %}
<script>
// –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
const cards = document.querySelectorAll('.product-card');
cards.forEach((card, i) => {
    card.style.opacity = 0;
    setTimeout(() => {
        card.style.transition = 'opacity 0.5s';
        card.style.opacity = 1;
    }, 100 + i * 150);
});

// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –≤—Å–ø–ª—ã—Ç–∏—è —Å–æ–±—ã—Ç–∏–π –æ—Ç –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
document.addEventListener('DOMContentLoaded', function() {
    const actionButtons = document.querySelectorAll('.product-actions .btn, .product-actions form');
    actionButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    });
});
</script>
{% endblock %}

{% include 'components/delete_modal.html' %} 