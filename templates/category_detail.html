{% extends "base.html" %}

{% block title %}{{ category.title }} - {{ category.section.name }}{% if is_demo %} - –î–µ–º–æ{% endif %}{% endblock %}

{% set breadcrumbs %}
    {% if is_demo %}
    <li class="breadcrumb-item"><a href="/demo">–î–µ–º–æ-—Ä–µ—Å—Ç–æ—Ä–∞–Ω</a></li>
    <li class="breadcrumb-item"><a href="/restaurants/{{ category.restaurant.id }}/sections/{{ category.section.id }}">{{ category.section.name }}</a></li>
    <li class="breadcrumb-item active" aria-current="page"><span>{{ category.title }}</span></li>
    {% else %}
    {% if user and user.role == 'admin' %}
    <li class="breadcrumb-item"><a href="/restaurants">–†–µ—Å—Ç–æ—Ä–∞–Ω—ã</a></li>
    {% endif %}
    <li class="breadcrumb-item"><a href="/restaurants/{{ category.restaurant.id }}">{{ category.restaurant.name }}</a></li>
    <li class="breadcrumb-item"><a href="/restaurants/{{ category.restaurant.id }}/sections/{{ category.section.id }}">{{ category.section.name }}</a></li>
    <li class="breadcrumb-item active" aria-current="page"><span>{{ category.title }}</span></li>
    {% endif %}
{% endset %}

{% block content %}
    <div class="page-header-unified">
        <h1>{{ category.title }}</h1>
        {% if user and user.role in ['admin', 'manager'] %}
        <div class="management-buttons">
            <a href="/manage/products/create/{{ category.id }}" class="btn btn-success btn-lg" title="–°–æ–∑–¥–∞—Ç—å –±–ª—é–¥–æ">
                ‚ûï
            </a>
        </div>
        {% endif %}
    </div>

    {% if products %}
    <div class="products-grid">
        {% for product in products %}
        <div class="product-card">
            <div class="product-content" onclick="window.location.href='/restaurants/{{ category.restaurant.id }}/sections/{{ category.section.id }}/categories/{{ category.id }}/products/{{ product.id }}'">
                <!-- –§–æ—Ç–æ –ø—Ä–æ–¥—É–∫—Ç–∞ -->
                <div class="product-image">
                    {% if product.photo_url %}
                        <img src="{{ product.photo_url }}" alt="{{ product.title }}">
                    {% else %}
                        üì∏
                    {% endif %}
                </div>
                <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ -->
                <h5 class="product-title">
                    {{ product.title }}
                </h5>
            </div>
            {% if user and user.role in ['admin', 'manager'] %}
            <div class="product-actions">
                <a href="/manage/products/edit/{{ product.id }}" class="btn btn-outline-warning btn-sm">‚úèÔ∏è</a>
                <button type="button" class="btn btn-outline-danger btn-sm" 
                        data-delete-url="/manage/products/delete/{{ product.id }}"
                        data-delete-message="–£–¥–∞–ª–∏—Ç—å –±–ª—é–¥–æ ¬´{{ product.title }}¬ª? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.">
                    üóëÔ∏è
                </button>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="text-center py-5">
            <h3 class="text-muted mb-3">–ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ</h3>
            <p class="text-muted mb-4">–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç –±–ª—é–¥.</p>
            {% if user and user.role in ['admin', 'manager'] %}
            <a href="/manage/products/create/{{ category.id }}" class="btn btn-success btn-lg">
                ‚ûï –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–µ –±–ª—é–¥–æ
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <div class="back-button-container">
        <a href="/restaurants/{{ category.restaurant.id }}/sections/{{ category.section.id }}" class="btn-back">‚Üê –ù–∞–∑–∞–¥ –∫ —Ä–∞–∑–¥–µ–ª—É</a>
    </div>
{% endblock %}

{% block scripts %}
<script>
// –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
const cards = document.querySelectorAll('.card');
cards.forEach((card, i) => {
    card.style.opacity = 0;
    setTimeout(() => {
        card.style.transition = 'opacity 0.5s';
        card.style.opacity = 1;
    }, 100 + i * 150);
});

// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –≤—Å–ø–ª—ã—Ç–∏—è —Å–æ–±—ã—Ç–∏–π –æ—Ç –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
const actionButtons = document.querySelectorAll('.product-actions .btn');
actionButtons.forEach(button => {
    button.addEventListener('click', function(e) {
        e.stopPropagation();
    });
});
</script>
{% endblock %}

{% include 'components/delete_modal.html' %} 